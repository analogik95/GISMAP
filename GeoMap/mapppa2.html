<!DOCTYPE html>
<html>
<head>
    <title>Geo Localization App with Cadastral Layer</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/papaparse/papaparse.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        #map { height: 600px; }
        .info-popup { max-width: 250px; }
        .info-popup dt { font-weight: bold; }
        .info-popup dd { margin: 0 0 10px; }
        .search-controls { margin-bottom: 10px; }
        .search-controls label, .search-controls button { margin-right: 5px; }
    </style>
</head>
<body>

<div class="search-controls">
    <label for="searchColumn">Search Column:</label>
    <select id="searchColumn">
        <!-- Columns will be populated dynamically -->
    </select>

    <label for="searchQuery">Search Query:</label>
    <input type="text" id="searchQuery" placeholder="Enter search term...">

    <button onclick="applySearch()">Search</button>
</div>

<div id="map"></div>

<script>
    var map = L.map('map').setView([40.4643608, 17.2470303], 13); // Center on Italy
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    var markers = L.markerClusterGroup();
    var allData = [];

    // Adding the CadastralParcel layer using WMS
    var wmsLayer = L.tileLayer.wms("https://wms.cartografia.agenziaentrate.gov.it/inspire/wms/ows01.php", {
        layers: 'CP.CadastralParcel', // This is the layer for cadastral parcels
         
        format: 'image/png',
        transparent: true,
        version: '1.3.0',
        attribution: '© Agenzia delle Entrate - Cartografia Catastale'
    }).addTo(map);

    // ... Rest of the code for adding markers and search functionality
    // This part should include the actual implementation for parsing your CSV data and adding markers based on it, along with the search functionality.

</script>

</body>
</html>
